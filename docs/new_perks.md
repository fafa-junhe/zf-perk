
## 新增幸存者职业 (New Survivor Perks)

### 22. 狂战士 (Berserker)
*   **ID:** `ZF_PERK_BERSERKER`
*   **介绍:** /新增/ 狂战士(Berserker)——濒死之际，怒火燎原
*   **详细描述:** 你的防御力永久降低。但你的生命值越低，你的攻击速度和近战吸血效果就越强。生命值低于25%时，效果达到最大值。“死亡也无法阻止我！” 推荐职业: 爆破骑士、火焰兵。
*   **设计思路:** 一个高风险高回报的近战职业。鼓励玩家在刀尖上跳舞，通过吸血维持低血量下的高输出。
    *   **永久属性:** 永久降低防御力 (`-25%`)。
    *   **条件逻辑 (`updateCondStats`):** 根据当前生命值百分比，线性地增加攻击速度和近战吸血率。例如，在25%生命值时达到最大加成（`+150% ROF`, `+50% Melee Lifesteal`）。

### 24. 登山家 (Mountaineer)
*   **ID:** `ZF_PERK_MOUNTAINEER`
*   **介绍:** /新增/ 登山家(Mountaineer)——飞檐走壁，机动大师
*   **详细描述:** 你免疫掉落伤害，并能攀附在墙壁上。对着墙壁按住跳跃键可以向上攀爬，松开则落下。发医生语音可以向前发射一枚抓钩，将你快速拉向目标点。冷却时间12秒。“这儿的地形对我很有利。” 推荐职业: 狙击手、侦察兵。
*   **设计思路:** 引入Z轴的机动性，为特定职业提供到达非常规位置的能力。
    *   **事件处理 (`OnPlayerRunCmd`):** 检测玩家是否面向墙壁并按下跳跃键，如果是，则施加一个向上的速度。
    *   **事件处理 (`perk_OnTakeDamage`):** 免疫坠落伤害。
    *   **事件处理 (`perk_OnCallForMedic`):** 向准星方向发射一个不可见的投射物，命中后将玩家拉向命中点。

### 25. 炼金术士 (Alchemist)
*   **ID:** `ZF_PERK_ALCHEMIST`
*   **介绍:** /新增/ 炼金术士(Alchemist)——投掷药剂，扭转战局
*   **详细描述:** 你每40秒会自动调和一瓶药剂，最多持有3瓶。发医生语音投掷一瓶药剂，击中地面会产生持续10秒的效果区域。友军进入会缓慢回血并获得速度加成；僵尸进入则会减速并持续受到少量伤害。“尝尝我的新发明！” 推荐职业: 医生、士兵。
*   **设计思路:** 一个区域控制和支援型职业，提供灵活的战场增益/减益。
    *   **状态变量:** `zf_perkState` 存储药剂数量。`zf_perkTimer` 计时生成药剂。
    *   **事件处理 (`perk_OnCallForMedic`):** 消耗一瓶药剂，投掷一个瓶子实体。实体破碎后生成一个光环区域，在区域内的玩家会触发相应的增益/减益效果。

### 26. 守护者 (Guardian)
*   **ID:** `ZF_PERK_GUARDIAN`
*   **介绍:** /新增/ 守护者(Guardian)——坚守阵地，寸土不让
*   **详细描述:** 当你站立不动超过3秒时，会以自身为中心展开一个“守护力场”。力场会为你和范围内的队友提供防御力加成，并轻微推开靠近的僵尸。移动后力场消失。“有我在此，别想前进一步！” 推荐职业: 士兵。
*   **设计思路:** 鼓励阵地防守，创造一个移动的安全区。
    *   **条件逻辑 (`updateCondStats`):** 检测玩家是否静止。静止超过3秒，则激活一个光环。光环内的队友获得防御加成，靠近的僵尸受到一个持续的、微弱的推力。

### 27. 赌徒 (Gambler)
*   **ID:** `ZF_PERK_GAMBLER`
*   **介绍:** /新增/ 赌徒(Gambler)——好运连连，还是厄运缠身？
*   **详细描述:** 你的暴击率被替换为“幸运值”。每次攻击都有[幸运值]%的几率触发随机效果：造成3倍暴击伤害、立即装填满弹药、获得5秒移速加成，或是...攻击哑火并对自己造成10点伤害。每次击杀会增加2点幸运值，每次助攻增加1点，每次攻击命中（无论是否触发效果）会消耗1点。幸运值上限为30。“人生就是一场豪赌！” 推荐职业: 任何喜欢刺激的玩家。
*   **设计思路:** 一个完全基于随机性的娱乐职业，可能创造奇迹，也可能自寻死路。
    *   **永久属性:** 暴击率-100%。
    *   **状态变量:** `zf_perkState` 存储“幸运值”。
    *   **事件处理 (`perk_OnCalcIsAttackCritical`):** 禁用原版暴击，改为触发一个自定义的随机函数，根据幸运值决定是否触发以及触发何种效果。


---
## 新增僵尸职业 (New Zombie Perks)

### 18. 腐蚀者 (Corruptor)
*   **ID:** `ZF_PERK_CORRUPTOR`
*   **介绍:** /新增/ 腐蚀者(Corruptor)——感染建筑，为我所用
*   **详细描述:** 你的移动速度降低，但对工程师的建筑造成额外伤害。当你持续攻击一个步哨5秒后，可以将其“腐化”。被腐化的建筑会变为蓝方的建筑（僵尸方，所有者为攻击者），转而对幸存者造成伤害，持续15秒，随后损坏。“你的造物现在听命于我。” 推荐职业: 机枪手。
*   **设计思路:** 针对工程师的强力反制单位，能将敌人的防御工事变为己用。
    *   **条件逻辑 (`updateCondStats`):** 如果正在攻击建筑，则开始计时。计时满5秒，触发腐化效果。
    *   **建筑逻辑:** 通过`SetEntProp`修改建筑的目标筛选和`m_bDisabled`属性，并创建一个定时器在15秒后恢复正常。

### 19. 寄生体 (Parasite)
*   **ID:** `ZF_PERK_PARASITE`
*   **介绍:** /新增/ 寄生体(Parasite)——吸取生命，窃取超能
*   **详细描述:** 你的生命值较低。你的近战攻击会持续吸取幸存者的生命值，并能偷取医生的Ubercharge能量。当你吸取了足够的能量后，发医生语音可以激活“超能爆发”，获得10秒的巨额速度和攻击加成。之后进入虚弱状态。“你的能量，就是我的养料。” 推荐职业: 间谍、侦察兵。
*   **设计思路:** 一个滚雪球式的刺客僵尸，针对医生，并能通过成功偷袭获得爆发能力。
    *   **事件处理 (`perk_OnTakeDamage`):** 命中时，偷取生命和Uber值，存入`zf_perkState`。
    *   **事件处理 (`perk_OnCallForMedic`):** 消耗`zf_perkState`中的能量，提供临时强大增益，结束后施加一个负面状态。

### 20. 幽影 (Phantasm)
*   **ID:** `ZF_PERK_PHANTASM`
*   **介绍:** /新增/ 幽影(Phantasm)——穿行虚空，无视阻碍
*   **详细描述:** 你的生命值和攻击力都较低。发医生语音可以进入“虚空行走”状态，持续4秒。在此状态下，你可以穿过幸存者和他们建造的障碍物（如木工的路障），但无法攻击。冷却时间12秒。“墙壁也拦不住我。” 推荐职业: 间谍。
*   **设计思路:** 极致的渗透单位，可以绕过坚固的防线，直击后排。
    *   **事件处理 (`perk_OnCallForMedic`):** 激活状态，将玩家模型设为半透明，并临时禁用碰撞（`SetEntityMoveType(client, MOVETYPE_NOCLIP)`），同时无法攻击。

### 21. 冲撞者 (Charger)
*   **ID:** `ZF_PERK_CHARGER`
*   **介绍:** /新增/ 冲撞者(Charger)——蛮力冲锋，势不可挡
*   **详细描述:** 防御力偏高，伤害略低，速度慢，但是发医生语音会向前方进行一次长距离冲锋。冲锋期间免疫击退。第一个被你撞到的幸存者会被你带走，直到撞上墙壁，届时你和幸存者都会受到大量伤害并被击晕。“让开，火车来了！” 推荐职业: 机枪手。
*   **设计思路:** 灵感源自L4D2的Charger，一个能破坏阵型、强制位移的强力单位。
    *   **事件处理 (`perk_OnCallForMedic`):** 锁定当前方向，施加一个巨大的前向速度。
    *   **事件处理 (`perk_OnTouch`):** 冲锋时接触到幸存者，则“抓住”对方（通过某种方式将其位置绑定在自己前方），直到撞墙。撞墙后，对自己和被抓者造成伤害并施加眩晕。

### 22. 霸主 (Overlord)
*   **ID:** `ZF_PERK_OVERLORD`
*   **介绍:** /新增/ 霸主(Overlord)——散播菌毯，强化集群
*   **详细描述:** 你的移动速度非常慢，但生命值极高。发医生语音可以在脚下生成一小块“菌毯”，菌毯会缓慢扩散。站在菌毯上的所有僵尸（包括你自己）都会获得移动速度和生命恢复加成。菌毯可被攻击来消除。“在我的领域里，我们势不可挡。” 推荐职业: 机枪手。
*   **设计思路:** 一个移动的战略据点，为僵尸群提供强大的阵地战能力。
    *   **事件处理 (`perk_OnCallForMedic`):** 放置一个“菌毯”核心实体。
    *   **条件逻辑 (`updateCondStats`):** 菌毯核心会定时在周围生成更多菌毯贴图。所有站在菌毯区域的僵尸获得增益。伤害会摧毁菌毯实体。

### 23. 模仿者 (Mimic)
*   **ID:** `ZF_PERK_MIMIC`
*   **介绍:** /新增/ 模仿者(Mimic)——伪装潜入，致命一击
*   **详细描述:** 你的攻击力大幅降低。发医生语音可以伪装成一名随机的幸存者职业，持续20秒或直到你攻击。伪装状态下，你的名字和模型会变成友方，但步哨枪仍然会攻击你。伪装后的第一次攻击会造成额外伤害。冷却时间40秒。“嘿，伙计，需要帮忙吗？” 推荐职业: 间谍。
*   **设计思路:** 终极的欺骗与心理战职业，制造混乱与不信任。
    *   **事件处理 (`perk_OnCallForMedic`):** 改变玩家模型、队伍、名字颜色。设置一个状态标记。
    *   **事件处理 (`perk_OnTakeDamage`):** 攻击时，如果处于伪装状态，则造成额外伤害，并立即解除伪装。

### 24. 易爆者 (Volatile)
*   **ID:** `ZF_PERK_VOLATILE`
*   **介绍:** /新增/ 易爆者(Volatile)——承受伤害，加倍奉还
*   **详细描述:** 你受到的所有伤害都会被储存为“不稳定的能量”。当你死亡时，你会根据储存的能量总量引发一场剧烈爆炸。发医生语音可以主动引爆，但伤害减半。能量会随时间缓慢流失。“打我越狠，你们死得越惨。” 推荐职业: 任何。
*   **设计思路:** “自爆僵尸”的变体，将伤害吸收与输出直接挂钩，让幸存者在攻击时有所顾忌。
    *   **状态变量:** `zf_perkState` 存储能量。
    *   **事件处理 (`perk_OnTakeDamage`):** 受伤时，将伤害值的一部分存入`zf_perkState`。
    *   **事件处理 (`perk_OnPlayerDeath`):** 触发爆炸，伤害与`zf_perkState`的值成正比。
    *   **事件处理 (`perk_OnCallForMedic`):** 主动触发爆炸，但伤害打折扣，并杀死自己。


## 新增幸存者职业 (More Interesting Survivor Perks)

### 32. 幽灵 (Specter)
*   **ID:** `ZF_PERK_SPECTER`
*   **介绍:** /新增/ 幽灵(Specter)——极限伤害，一触即碎
*   **详细描述:** 你的攻击力、暴击率和移动速度都得到极大提升。但是，你的生命值上限被永久锁定在1点，且无法被任何方式治疗。发医生语音可以让你进入短暂的“相位”状态，免疫所有伤害但无法攻击，作为最后的保命手段。“要么他们死，要么我死。没有中间选项。” 推荐职业: 狙击手。
*   **设计思路:** 极致的“玻璃大炮”。将风险与回报推向顶峰。选择这个职业的玩家必须拥有顶尖的走位和战场意识，任何一个微小的失误都是致命的。这为高手提供了carry全场的可能性，也为游戏带来了极大的不确定性和观赏性。
    *   **永久属性 (`updateClientPermStats`):** 施加巨额正面buff。
    *   **永久效果 (`updateClientPermEffects`):** `SetEntityHealth(client, 1)`，并创造一个定时器每秒都强制设为1，防止被治疗。
    *   **事件处理 (`perk_OnTakeDamage`):** 受到的任何伤害都直接触发死亡。
    *   **主动技能 (`perk_OnCallForMedic`):** 施加无敌和缴械状态，持续2-3秒。

## 新增僵尸职业 (More Interesting Zombie Perks)

### 25. 妄孽 (Delirium)
*   **ID:** `ZF_PERK_DELIRIUM`
*   **介绍:** /新增/ 妄孽(Delirium)——污染心智，制造幻象
*   **详细描述:** 靠近你的幸存者会间歇性地听到虚假的提示音（如间谍现身、队友呼叫医生）。发医生语音可以投掷一颗“幻象炸弹”，爆炸范围内的幸存者将在一段时间内视野严重扭曲，HUD信息错乱（错误的伤害/防御显示等），并看到不存在的僵尸幻影。“你看到的，是真的吗？” 推荐职业: 侦察兵。
*   **设计思路:** 一个不造成直接伤害，但从心理和信息层面进行攻击的职业。它的目标是瓦解幸存者的沟通与信任，制造混乱，为其他僵尸的进攻创造机会。
    *   **被动光环 (`updateCondStats`):** 对范围内的幸存者，使用`ClientCommand`播放随机的假音效。
    *   **主动技能 (`perk_OnCallForMedic`):** 投掷物爆炸后，对范围内的幸存者施加屏幕滤镜和抖动效果，并通过定时器不断用`SetHudText`发送虚假信息。幻影僵尸可以用客户端实体创建。

### 26. 地卜师 (Geomancer)
*   **ID:** `ZF_PERK_GEOMANCER`
*   **介绍:** /新增/ 地卜师(Geomancer)——升起石墙，分割战场
*   **详细描述:** 你的移动速度缓慢。发医生语音可以在你面前的直线上瞬间升起一排石墙。石墙可以阻挡幸存者的移动和弹道，但有生命值，可以被摧毁。冷却时间较长。该技能可以用来封锁幸存者的退路、保护僵尸队友免受火力攻击，或者将一个幸存者孤立起来。“大地听我号令！” 推荐职业: 机枪手。
*   **设计思路:** 一个创造动态掩体、改变战场地形的战略性僵尸。它的作用不是击杀，而是通过分割战场来打破幸存者固若金汤的防线，为团队创造进攻机会。
    *   **主动技能 (`perk_OnCallForMedic`):** 计算玩家朝向的矢量，然后在一个循环中，沿该矢量生成一连串可被破坏的障碍物实体（类似木工的路障，但无建造动画）。


---
## 新增幸存者职业 (Easy to Implement & Fun)

### 33. 回响者 (Echo)
*   **ID:** `ZF_PERK_ECHO`
*   **介绍:** /新增/ 回响者(Echo)——以彼之道，还施彼身
*   **详细描述:** 你免疫击退效果。你受到的每一次僵尸近战攻击，都会储存一小部分“回响能量”。发医生语音可以释放所有能量，对周围的僵尸造成一次强力的击退，能量越多，击退力度越强。“你推不动我，但我可以把你推下悬崖。” 推荐职业: 任何需要坚守阵地的职业。
*   **实现思路:**
    *   **免疫击退 (`perk_OnTakeDamage`):** 当伤害类型是击退时，返回`Plugin_Stop`或修改速度为0。
    *   **能量储存 (`perk_OnTakeDamage`):** 当受到僵尸近战伤害时，`zf_perkState[client] += 1`。
    *   **能量释放 (`perk_OnCallForMedic`):** 遍历周围僵尸，使用`fxKnockback`，其力度与`zf_perkState[client]`成正比。释放后`zf_perkState[client] = 0`。

### 35. 弹射专家 (Ricochet Specialist)
*   **ID:** `ZF_PERK_RICOCHET_SPECIALIST`
*   **介绍:** /新增/ 弹射专家(Ricochet Specialist)——一发子弹，多重惊喜
*   **详细描述:** 你的子弹类武器伤害降低30%，但你的子弹在击中僵尸后有50%的几率弹射到附近另一个僵尸身上，弹射伤害为原伤害的一半。最多弹射两次。并显示一个电击特效来代表弹射，“一石二鸟？我能做到一石三鸟。” 推荐职业: 工程师、狙击手。
*   **实现思路:**
    *   **伤害降低 (`perk_OnTakeDamage`):** 对子弹伤害应用`-30%`的`localAttAdjust`。
    *   **弹射逻辑 (`perk_OnTakeDamagePost`):** 在伤害发生后，随机数判定是否弹射。如果成功，遍历被击中僵尸周围的其他僵尸，找到最近的一个，然后用`SDKHooks_TakeDamage`对其造成`damage * 0.5`的伤害。可以设置一个状态量防止无限弹射。

---
## 新增僵尸职业 (Easy to Implement & Fun)

### 30. 静电场 (Static Field)
*   **ID:** `ZF_PERK_STATIC_FIELD`
*   **介绍:** /新增/ 静电场(Static Field)——你跑得越快，电得越狠
*   **详细描述:** 你自身周围存在一个静电场。进入电场的幸存者移动得越快，受到的伤害就越高。站着不动则几乎不受伤害。“想从我身边跑过去？先尝尝静电的滋味。” 推荐职业: 任何。
*   **实现思路:**
    *   **伤害逻辑 (`updateCondStats`):** 遍历周围的幸存者。获取幸存者的当前速度`GetEntPropVector(sur, Prop_Data, "m_vecVelocity")`，计算其速率`GetVectorLength`。然后使用`SDKHooks_TakeDamage`对幸存者造成一个与速率成正比的伤害。

### 31. 重力扭曲者 (Gravity Warper)
*   **ID:** `ZF_PERK_GRAVITY_WARPER`
*   **介绍:** /新增/ 重力扭曲者(Gravity Warper)——改变重力，扰乱跳跃
*   **详细描述:** 在你附近的幸存者，他们的跳跃高度会大幅降低，并且受到的坠落伤害会增加。“在这片区域，重力由我说了算。” 推荐职业: 任何。
*   **实现思路:**
    *   **影响重力 (`updateCondStats`):** 遍历周围幸存者，使用`void SetEntityGravity(int entity, 0.5)`来降低其重力（注意，这会让他们跳得更高，你需要设为`1.5`或更高才能让他们跳得更低）。或者更简单的方法是在幸存者跳跃时（`OnPlayerRunCmd`检查`IN_JUMP`）给他们施加一个向下的推力。
    *   **增加坠落伤害 (`perk_OnTakeDamage`):** 当重力扭曲者是“攻击者”（由光环造成），并且伤害类型是坠落伤害时，将伤害`damage`乘以一个倍数。
