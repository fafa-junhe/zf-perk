# 潜行僵尸 (Thieving)

## 简介

> *“这可比拳头好使多了!”*

**潜行僵尸** 是一个极具骚扰性和破坏性的职业。它以大幅削弱自身直接伤害为代价，换来了通过近战攻击偷取幸存者宝贵资源的能力。更致命的是，它有机会直接偷走幸存者的主武器并据为己有。

## 详细说明

潜行僵尸的核心机制是 **偷窃**。

- **被动能力 (资源偷窃)**:
    - 你的近战攻击会根据幸存者当前手持的武器类型，偷取不同的资源：
        - **主武器 (Slot 0)**: 偷取目标 **30%** 的备用弹药。
        - **副武器 (Slot 1)**: 偷取目标 **50%** 的Ubercharge能量和 **30%** 的备用弹药。
        - **近战武器 (Slot 2)**: 偷取目标 **100** 金属。
- **被动能力 (武器偷窃)**:
    - 当你通过攻击将一个幸存者的主武器备用弹药偷光时，你会直接 **偷走** 他们的主武器。
    - 你会获得一把与你当前职业相对应的主武器，并带有少量弹药。
    - 你偷来的武器弹药会随时间快速消耗，弹药耗尽后武器会自动消失。
- **属性调整**:
    - **攻击力**: 你的近战攻击力大幅降低 **66%**。

## 参数

| 参数名 | 值 | 描述 |
| :--- | :--- | :--- |
| `ZF_THIEVING_ATTACK` | `-66` | 使用该职业时的近战攻击力惩罚百分比。 |
| `Float:ZF_THIEVING_AMMOPCT` | `0.30` | 每次近战攻击偷取的备用弹药百分比。 |
| `ZF_THIEVING_METAL` | `100` | 每次近战攻击偷取的金属量。 |
| `Float:ZF_THIEVING_UBERPCT` | `0.50` | 每次近战攻击偷取的Ubercharge百分比。 |

## 事件处理逻辑

- **`updateClientPermStats`**:
    - 为潜行僵尸应用永久的攻击力惩罚 (`ZF_THIEVING_ATTACK`)。

- **`perk_OnTakeDamage`**:
    - 当潜行僵尸近战攻击幸存者时触发。
    - 根据幸存者当前武器槽位，调用 `subResAmmoPct`, `subUber`, `subMetal` 来减少相应资源。
    - 如果主武器的备用弹药被偷光 (`getResAmmoPct == 0.0`)，则调用 `doThievingSteal`。

- **`doThievingSteal(attacker, victim, slot)`**:
    - **受害者**: 移除其主武器 (`stripWeaponSlot`) 并强制切换到近战武器。
    - **攻击者**: 如果攻击者手上没有偷来的武器 (`zf_perkState == 0`)，则为其生成一把对应职业的主武器，并设置少量初始弹药 (`zf_perkState`)。

- **`perk_OnGameFrame`**:
    - 如果潜行僵尸拥有偷来的武器 (`zf_perkState > 0`)，则调用 `doThievingLimit`。

- **`doThievingLimit(client)`**:
    - 持续减少偷来武器的弹药。
    - 当弹药耗尽时 (`zf_perkState == 0`)，移除该武器。

- **`perk_OnPlayerSpawn`**:
    - 重置 `zf_perkState`，确保重生后没有偷来的武器。

## 推荐职业

- **任何职业**: 潜行僵尸的能力不依赖于特定的基础职业。它的核心玩法在于骚扰和削弱幸存者的战斗力，任何职业都可以有效地执行这一任务。